version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Install basic dependencies (Amazon Linux 2023 uses dnf)
        - sudo dnf install -y wget tar gzip
        # Install TeX Live with ctex support
        # Install TeX Live with Chinese support (works on Amazon Linux 2023)
        - |
          echo "Installing TeX Live with ctex support..."
          sudo dnf install -y texlive-scheme-basic texlive-xetex texlive-collection-langchinese
          echo "TeX Live installation completed with Chinese support"
        # Install Pandoc from GitHub releases (dnf package not available)
        - |
          echo "Installing Pandoc from GitHub releases..."
          wget -q https://github.com/jgm/pandoc/releases/download/3.1.8/pandoc-3.1.8-linux-amd64.tar.gz
          tar -xzf pandoc-3.1.8-linux-amd64.tar.gz
          sudo cp pandoc-3.1.8/bin/pandoc /usr/local/bin/
          sudo chmod +x /usr/local/bin/pandoc
          rm -rf pandoc-3.1.8*
        # Verify installations
        - xelatex --version
        - pandoc --version
    build:
      commands:
        - echo "Building LaTeX document..."
        - make build
        - echo "Building HTML version..."
        - make html
        - echo "Build complete!"
  artifacts:
    baseDirectory: public
    files:
      - '**/*'
  cache:
    paths:
      - build/**/*
      - node_modules/**/*